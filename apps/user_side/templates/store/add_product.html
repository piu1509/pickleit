{% extends 'base/base_user_store.html' %}
{% load static %}

{% block content %}
<div class="container">
    <div class="d-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 m-0">Add My Product</h1>
    </div>
    <div class="add-product-form">
        <form action="{% url 'user_side:add_store_product_user_side' %}" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <!-- MerchandiseStoreProduct Fields -->
            <div class="row mb-3">
                <div class="col-12">
                    <label for="product_name" class="form-label">Product Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="product_name" name="product_name" required>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-12">
                    <label for="product_description" class="form-label">Product Description <span class="text-danger">*</span></label>
                    <textarea class="form-control" id="product_description" name="product_description" rows="4" required></textarea>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-12">
                    <label for="product_specifications" class="form-label">Specifications</label>
                    <textarea class="form-control" id="product_specifications" name="product_specifications" rows="4"></textarea>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6 col-12">
                    <label for="product_category" class="form-label">Product Category <span class="text-danger">*</span></label>
                    <select class="form-select" id="product_category" name="product_category" required>
                        <option value="" disabled selected>Select a category</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6 col-12">
                    <label for="leagues_for" class="form-label">Leagues</label>
                    <select class="form-select" id="leagues_for" name="leagues_for" multiple>
                        {% for league in leagues %}
                            <option value="{{ league.id }}">{{ league.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-12">
                    <label for="product_image" class="form-label">Product Image</label>
                    <input type="file" class="form-control" id="product_image" name="product_image" accept="image/*">
                </div>
            </div>
            <!-- MerchandiseProductSpecification Fields (Dynamic) -->
            <div class="mb-3">
                <label class="form-label">Product Specifications <span class="text-danger">*</span></label>
                <div id="specifications-container">
                    <div class="specification-group mb-3 p-3 border rounded">
                        <div class="row">
                            <div class="col-md-3 col-6 mb-2">
                                <label for="product_size_0" class="form-label">Size</label>
                                <input type="text" class="form-control" id="product_size_0" name="product_size[]" maxlength="5">
                            </div>
                            <div class="col-md-3 col-6 mb-2">
                                <label for="old_price_0" class="form-label">Old Price</label>
                                <input type="number" class="form-control" id="old_price_0" name="old_price[]" step="0.01">
                            </div>
                            <div class="col-md-3 col-6 mb-2">
                                <label for="current_price_0" class="form-label">Current Price <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="current_price_0" name="current_price[]" step="0.01" required>
                            </div>
                            <div class="col-md-3 col-6 mb-2">
                                <label for="total_product_0" class="form-label">Total Quantity <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="total_product_0" name="total_product[]" required>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-danger remove-specification d-none">Remove</button>
                    </div>
                </div>
                <button type="button" class="btn btn-secondary mt-2" id="add-specification">Add Another Specification</button>
            </div>
            <!-- ProductSpecificationHighlights Fields (Dynamic) -->
            <div class="mb-3">
                <label class="form-label">Specification Highlights</label>
                <div id="highlights-container">
                    <div class="highlight-group mb-3 p-3 border rounded">
                        <div class="row">
                            <div class="col-md-6 col-12 mb-2">
                                <input type="text" class="form-control" name="highlight_key[]" placeholder="Highlight Key">
                            </div>
                            <div class="col-md-6 col-12 mb-2">
                                <textarea class="form-control" name="highlight_des[]" rows="2" placeholder="Highlight Description"></textarea>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-danger remove-highlight d-none">Remove</button>
                    </div>
                </div>
                <button type="button" class="btn btn-secondary mt-2" id="add-highlight">Add Another Highlight</button>
            </div>
            <button type="submit" class="btn btn-primary">Add Product</button>
        </form>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script>
    document.getElementById('add-specification').addEventListener('click', function() {
        const container = document.getElementById('specifications-container');
        const index = container.children.length;
        const newSpec = document.createElement('div');
        newSpec.className = 'specification-group mb-3 p-3 border rounded';
        newSpec.innerHTML = `
            <div class="row">
                <div class="col-md-3 col-6 mb-2">
                    <label for="product_size_${index}" class="form-label">Size</label>
                    <input type="text" class="form-control" id="product_size_${index}" name="product_size[]" maxlength="5">
                </div>
                <div class="col-md-3 col-6 mb-2">
                    <label for="old_price_${index}" class="form-label">Old Price</label>
                    <input type="number" class="form-control" id="old_price_${index}" name="old_price[]" step="0.01">
                </div>
                <div class="col-md-3 col-6 mb-2">
                    <label for="current_price_${index}" class="form-label">Current Price <span class="text-danger">*</span></label>
                    <input type="number" class="form-control" id="current_price_${index}" name="current_price[]" step="0.01" required>
                </div>
                <div class="col-md-3 col-6 mb-2">
                    <label for="total_product_${index}" class="form-label">Total Quantity <span class="text-danger">*</span></label>
                    <input type="number" class="form-control" id="total_product_${index}" name="total_product[]" required>
                </div>
            </div>
            <button type="button" class="btn btn-sm btn-danger remove-specification">Remove</button>
        `;
        container.appendChild(newSpec);
        updateRemoveButtons('specification-group', 'remove-specification');
    });

    document.getElementById('add-highlight').addEventListener('click', function() {
        const container = document.getElementById('highlights-container');
        const newHighlight = document.createElement('div');
        newHighlight.className = 'highlight-group mb-3 p-3 border rounded';
        newHighlight.innerHTML = `
            <div class="row">
                <div class="col-md-6 col-12 mb-2">
                    <input type="text" class="form-control" name="highlight_key[]" placeholder="Highlight Key">
                </div>
                <div class="col-md-6 col-12 mb-2">
                    <textarea class="form-control" name="highlight_des[]" rows="2" placeholder="Highlight Description"></textarea>
                </div>
            </div>
            <button type="button" class="btn btn-sm btn-danger remove-highlight">Remove</button>
        `;
        container.appendChild(newHighlight);
        updateRemoveButtons('highlight-group', 'remove-highlight');
    });

    function updateRemoveButtons(groupClass, buttonClass) {
        const groups = document.getElementsByClassName(groupClass);
        for (let i = 0; i < groups.length; i++) {
            const removeButton = groups[i].getElementsByClassName(buttonClass)[0];
            removeButton.classList.toggle('d-none', groups.length === 1);
            removeButton.onclick = function() {
                groups[i].remove();
                updateRemoveButtons(groupClass, buttonClass);
            };
        }
    }

    // Initialize remove buttons on page load
    document.addEventListener('DOMContentLoaded', function() {
        updateRemoveButtons('specification-group', 'remove-specification');
        updateRemoveButtons('highlight-group', 'remove-highlight');
    });
</script>
{% endblock %}