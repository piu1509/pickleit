{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% load extra %}

{% block extra_css %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
{% endblock %}

{% block page_title %}
    Edit Club
{% endblock %}
{% block content %}
<div class="page-breadcrumb">
    <div class="row">
        <div class="col-12 d-flex no-block align-items-center">
            <h4 class="page-title">Edit Club Form </h4>
            <div class="ml-auto text-right">
                <nav aria-label="breadcrumb">
                    
                </nav>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid mt-4" style="margin-bottom: 100px;"> 
    <div class="card shadow p-5">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="mb-3">
                <label for="name" class="form-label">Club Name:</label>
                <input type="text" name="name" id="name" class="form-control" value="{{club.name}}" required>
            </div>

            <div class="mb-3">
                <label for="location" class="form-label">Location:</label>
                <textarea name="location" id="location" class="form-control" rows="3" required> {{club.location}}</textarea>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="open_time" class="form-label">Open Time:</label>
                    <input type="time" name="open_time" id="open_time"  class="form-control" value="{{club.open_time|time:'H:i'}}">
                </div>
                <div class="col-md-6 mb-3">
                    <label for="close_time" class="form-label">Close Time:</label>
                    <input type="time" name="close_time" id="close_time" class="form-control" value="{{club.close_time|time:'H:i'}}">
                </div>
            </div>

            <div class="mb-3">
                <label for="contact" class="form-label">Contact:</label>
                <input type="text" name="contact" id="contact" class="form-control" value="{{club.contact}}" required>
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">Email:</label>
                <input type="email" name="email" id="email" class="form-control" value="{{club.email}}">
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" name="is_vip" id="is_vip" class="form-check-input" {% if club.is_vip %}checked{% endif %}>
                <label for="is_vip" class="form-check-label">Is VIP</label>
            </div>

            <div class="mb-3">
                <label for="description" class="form-label">Description:</label>
                <textarea name="description" id="description" class="form-control" rows="4" required>{{club.description}}</textarea>
            </div>

            <div class="mb-3">
                <label for="join_amount" class="form-label">Join Amount:</label>
                <input type="number" step="0.01" name="join_amount" id="join_amount" class="form-control" value="{{club.join_amount}}" required>
            </div>

            <div class="mb-3">
                <label for="unit" class="form-label">Currency:</label>
                <select name="unit" id="unit" class="form-select">
                    <option value="USD" {% if club.unit == 'USD' %} selected {% endif %}>USD</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Existing Images:</label>
                <div id="existing-images">
                    {% for img in club_images %}
                        <div class="d-flex align-items-center mb-2" id="image-{{ img.id }}">
                            <img src="{{ img.image.url }}" alt="Image" width="80" class="me-2">

                            <a href="{{ img.image.url }}" target="_blank">{{ img.image.name|basename }}</a>
                            <button type="button" class="btn btn-sm btn-danger ms-2" onclick="markImageForDeletion({{ img.id }})">x</button>
                        </div>
                    {% empty %}
                    No existing image available.
                    {% endfor %}
                </div>
            </div>

            <!-- Hidden input to store deleted image IDs -->
            <input type="hidden" name="deleted_images" id="deleted-images">
            <div class="mb-3">
                <label class="form-label">Upload New Images:</label>
                <div id="image-upload-container">
                    <div class="input-group mb-2">
                        <input type="file" name="images" class="form-control" >
                        <button type="button" class="btn btn-info text-white add-image">+</button>
                    </div>
                </div>
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-success mt-3">Submit</button>
                <a href="{% url 'dashboard:club_list' filter_type='active' %}" class="btn btn-secondary font-weight-bold ml-2 mt-3">Cancel</a>
            </div>
        </form>
    </div>  
</div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAfBo6-cZlOpKGrD1ZYwISIGjYvhH_wPmk&libraries=places"></script>

<script>
  function initAutocomplete() {
    const input = document.getElementById('location');
    const autocomplete = new google.maps.places.Autocomplete(input, {
      types: ['geocode'], // You can change this to 'establishment' etc. if needed
      componentRestrictions: { country: 'in' } // Optional: restrict to a country (e.g., 'in' for India)
    });

    // Optional: Listener for when a place is selected
    autocomplete.addListener('place_changed', function () {
      const place = autocomplete.getPlace();
      console.log('Selected place:', place);
    });
  }

  // Load autocomplete on window load
  window.addEventListener('load', initAutocomplete);
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const container = document.getElementById("image-upload-container");

        container.addEventListener("click", function (event) {
            if (event.target.classList.contains("add-image")) {
                event.preventDefault();
                let newField = document.createElement("div");
                newField.classList.add("input-group", "mb-2");
                newField.innerHTML = `
                    <input type="file" name="images" class="form-control" required>
                    <button type="button" class="btn btn-danger remove-image">âž–</button>
                `;
                container.appendChild(newField);
            } else if (event.target.classList.contains("remove-image")) {
                event.preventDefault();
                event.target.parentElement.remove();
            }
        });
    });
</script>
<script>
    let deletedImageIds = [];

    function markImageForDeletion(imageId) {
        // Hide image from UI
        const imageDiv = document.getElementById(`image-${imageId}`);
        if (imageDiv) imageDiv.remove();

        // Add to deleted list
        deletedImageIds.push(imageId);
        document.getElementById("deleted-images").value = deletedImageIds.join(",");
    }
</script>


{% endblock %}

